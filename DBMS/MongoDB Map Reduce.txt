// Create the sales collection and insert data
db.sales.insertMany([
  { "_id": 1, "product": "Laptop", "quantity": 3, "price": 1000 },
  { "_id": 2, "product": "Mouse", "quantity": 5, "price": 50 },
  { "_id": 3, "product": "Laptop", "quantity": 2, "price": 1000 },
  { "_id": 4, "product": "Keyboard", "quantity": 10, "price": 100 },
  { "_id": 5, "product": "Mouse", "quantity": 3, "price": 50 }
]);

// Define the map function
var mapFunction = function() {
  // Emit the product name as the key and the total revenue (quantity * price) as the value
  emit(this.product, this.quantity * this.price);
};

// Define the reduce function
var reduceFunction = function(key, values) {
  // Sum the revenue values for the same product
  return Array.sum(values);
};

// Perform the map-reduce operation
db.sales.mapReduce(
  mapFunction,        // Map function
  reduceFunction,     // Reduce function
  {
    out: "total_revenue_per_product"  // Output collection to store the results
  }
);

// View the results from the output collection
db.total_revenue_per_product.find();
